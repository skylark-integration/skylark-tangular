/**
 * skylark-tangular - A version of tangular.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-tangular/
 * @license MIT
 */
!function(e,r){var t=r.define,require=r.require,n="function"==typeof t&&t.amd,a=!n&&"undefined"!=typeof exports;if(!n&&!t){var l={};t=r.define=function(e,r,t){"function"==typeof t?(l[e]={factory:t,deps:r.map(function(r){return function(e,r){if("."!==e[0])return e;var t=r.split("/"),n=e.split("/");t.pop();for(var a=0;a<n.length;a++)"."!=n[a]&&(".."==n[a]?t.pop():t.push(n[a]));return t.join("/")}(r,e)}),resolved:!1,exports:null},require(e)):l[e]={factory:null,resolved:!0,exports:t}},require=r.require=function(e){if(!l.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=l[e];if(!module.resolved){var t=[];module.deps.forEach(function(e){t.push(require(e))}),module.exports=module.factory.apply(r,t)||null,module.resolved=!0}return module.exports}}if(!t)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-tangular/tangular",["skylark-langx/skylark"],function(e){var r=e.attach("intg.totaljs.tangular",{});r.helpers={};return r.version="v3.0.1",r.cache={},r.debug=!1,r.toArray=function(e){for(var r=Object.keys(e),t=[],n=0,a=r.length;n<a;n++)t.push({key:r[n],value:e[r[n]]});return t},r}),e("skylark-tangular/Template",["./tangular"],function(e){var r={null:!0,undefined:!0,true:!0,false:!0},t=/&&|\|\|/,n=/[a-z0-9._]+/gi,a=/^[a-z0-9_$]+/i,l=/^[0-9]/,i=/'.*?'|".?"/g,s=/\{\{.*?\}\}/g,u=/\{\{|\}\}/g,o=/\n$/g;function c(){this.commands,this.variables,this.builder,this.split="\0"}return c.prototype.compile=function(e){var t,n=this,l=0,i=0,c=[];n.variables={},n.commands=[],n.builder=e.replace(s,function(e){var s,o=e.replace(u,"").trim(),p=null,f=null,h=!1,d=!1,g=!0;if("fi"===o)l--;else if("end"===o)i--,c.pop();else if("if "===o.substring(0,3)){if(l++,(p=n.parseVariables(o.substring(3),c)).length)for(var m=0;m<p.length;m++){var v=p[m];n.variables[v]?n.variables[v]++:n.variables[v]=1}else p=null;h=!0,g=!0}else if("foreach "===o.substring(0,8))i++,t=o.substring(8).split(" "),c.push(t[0].trim()),-1!==(s=t[2].indexOf("."))&&(t[2]=t[2].substring(0,s)),p=t[2].trim(),-1===c.indexOf(p)?(n.variables[p]?n.variables[p]++:n.variables[p]=1,p=[p]):p=null,d=!0;else if("else if "===o.substring(0,8)){if((p=n.parseVariables(o.substring(8),c)).length)for(var m=0;m<p.length;m++){var v=p[m];n.variables[v]?n.variables[v]++:n.variables[v]=1}else p=null;h=!0}else if("continue"!==o&&"break"!==o&&"else"!==o){if((p=o?o.match(a):null)&&(p=p.toString()),p&&r[p]&&(p=null),p&&-1===c.indexOf(p)?(n.variables[p]?n.variables[p]++:n.variables[p]=1,p=[p]):p=null,-1===o.indexOf("|")&&(o+=" | encode"),f=o.split("|"),o=f[0],(f=f.slice(1)).length)for(var m=0;m<f.length;m++){var b=f[m].trim();s=b.indexOf("("),b=-1===s?"Thelpers.$execute(model,'"+b+"',)":"Thelpers.$execute(model,'"+b.substring(0,s)+"',,"+b.substring(s+1),f[m]=b}else f=null;o=n.safe(o.trim()||"model"),g=!1}return n.commands.push({index:n.commands.length,cmd:o,ifcount:l,loopcount:i,variable:p,helpers:f,isloop:d,isif:h,iscode:g}),n.split}).split(n.split);for(var p=0,f=n.builder.length;p<f;p++)n.builder[p]=n.builder[p].replace(o,"");return n.make()},c.prototype.parseVariables=function(e,a){for(var s=[],u=e.split(t),o=0,c=u.length;o<c;o++)for(var p=u[o].replace(i,""),f=p.match(n),h=0;h<f.length;h++)!(p=(p=f[h]).split(".")[0])||l.test(p)||r[p]||-1===s.indexOf(p)&&-1===a.indexOf(p)&&s.push(p);return s},c.prototype.safe=function(e){for(var r=e.split("."),t=[],n=1;n<r.length;n++){var a=r.slice(0,n).join(".");t.push(a+"==null?'':")}return t.join("")+r.join(".")},c.prototype.make=function(){for(var e=["var $output=$text[0];var $tmp;var $index=0;"],r=0,t=this.commands.length;r<t;r++){var n,a=this.commands[r];if(r&&e.push("$output+=$text["+r+"];"),a.iscode)if(a.isloop){var l="$i"+Math.random().toString(16).substring(3,6),i=l+"a";n=a.cmd.substring(a.cmd.lastIndexOf(" in ")+4).trim(),n=i+"="+this.safe(n)+";if(!("+i+" instanceof Array)){if("+i+"&&typeof("+i+")==='object')"+i+"=Tangular.toArray("+i+")}if("+i+" instanceof Array&&"+i+".length){for(var "+l+"=0,"+l+"l="+i+".length;"+l+"<"+l+"l;"+l+"++){$index="+l+";var "+a.cmd.split(" ")[1]+"="+i+"["+l+"];",e.push(n)}else if(a.isif)"else if "===a.cmd.substring(0,8)?e.push("}"+a.cmd.substring(0,8).trim()+"("+a.cmd.substring(8).trim()+"){"):e.push(a.cmd.substring(0,3).trim()+"("+a.cmd.substring(3).trim()+"){");else switch(a.cmd){case"else":e.push("}else{");break;case"end":e.push("}}");break;case"fi":e.push("}");break;case"break":e.push("break;");break;case"continue":e.push("continue;")}else if(a.helpers){for(var s="",u=0;u<a.helpers.length;u++){var o=a.helpers[u];s=0===u?o.replace("",a.cmd.trim()).trim():o.replace("",s.trim())}e.push("$tmp="+s+";if($tmp!=null)$output+=$tmp;")}else e.push("if("+a.cmd+"!=null)$output+="+a.cmd+";")}e.push((t?"$output+=$text["+t+"];":"")+"returnÂ $output;"),delete this.variables.$;for(var c=Object.keys(this.variables),p=["$ || {}","model"],r=0;r<c.length;r++)p.push("model."+c[r]);var f="var tangular=function($,model"+(c.length?","+c.join(","):"")+"){"+e.join("")+"};return function(model,$){return tangular("+p.join(",")+");}";return new Function("$text",f)(this.builder)},c}),e("skylark-tangular/compile",["./tangular","./Template"],function(e,r){return e.compile=function(e){return(new r).compile(e)}}),e("skylark-tangular/helpers",["./tangular"],function(e){var r={},t=/[<>&"]/g;return r.$execute=function(e,t,n,a,l,i,s,u,o,c){return null==r[t]?(console&&console.warn("Tangular: missing helper",'"'+t+'"'),n):r[t].call(e,n,a,l,i,s,u,o,c)},r.encode=function(e){return null==e?"":e.toString().replace(t,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;"}return e})},r.raw=function(e){return e},e.helpers=r}),e("skylark-tangular/register",["./tangular","./helpers"],function(e,r){return e.register=function(e,t){return r[e]=t,this}}),e("skylark-tangular/render",["./tangular","./Template"],function(e,r){return e.render=function(e,t,n){return null==t&&(t={}),(new r).compile(e)(t,n)}}),e("skylark-tangular/main",["./tangular","./compile","./helpers","./register","./render","./Template"],function(e){return e}),e("skylark-tangular",["skylark-tangular/main"],function(e){return e})}(t),!n){var i=require("skylark-langx-ns");a?module.exports=i:r.skylarkjs=i}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-tangular.js.map
