/**
 * skylark-tangular - A version of tangular.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-tangular/
 * @license MIT
 */
!function(e,r){var t=r.define,n=r.require,a="function"==typeof t&&t.amd,l=!a&&"undefined"!=typeof exports;if(!a&&!t){var i={};t=r.define=function(e,r,t){"function"==typeof t?(i[e]={factory:t,deps:r.map(function(r){return function(e,r){if("."!==e[0])return e;var t=r.split("/"),n=e.split("/");t.pop();for(var a=0;a<n.length;a++)"."!=n[a]&&(".."==n[a]?t.pop():t.push(n[a]));return t.join("/")}(r,e)}),exports:null},n(e)):i[e]=t},n=r.require=function(e){if(!i.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var t=i[e];if(!t.exports){var a=[];t.deps.forEach(function(e){a.push(n(e))}),t.exports=t.factory.apply(r,a)}return t.exports}}if(!t)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,r){e("skylark-tangular/tangular",["skylark-langx/skylark"],function(e){var r=e.totaljs=e.totaljs||{},t=r.tangular={};t.helpers={};return t.version="v3.0.1",t.cache={},t.debug=!1,t.toArray=function(e){for(var r=Object.keys(e),t=[],n=0,a=r.length;n<a;n++)t.push({key:r[n],value:e[r[n]]});return t},t}),e("skylark-tangular/Template",["./tangular"],function(e){var r={null:!0,undefined:!0,true:!0,false:!0},t=/&&|\|\|/,n=/[a-z0-9._]+/gi,a=/^[a-z0-9_$]+/i,l=/^[0-9]/,i=/'.*?'|".?"/g,s=/\{\{.*?\}\}/g,u=/\{\{|\}\}/g,o=/\n$/g;function p(){this.commands,this.variables,this.builder,this.split="\0"}p.prototype.compile=function(e){var t,n=this,l=0,i=0,p=[];n.variables={},n.commands=[],n.builder=e.replace(s,function(e){var s,o=e.replace(u,"").trim(),c=null,f=null,h=!1,g=!1,d=!0;if("fi"===o)l--;else if("end"===o)i--,p.pop();else if("if "===o.substring(0,3)){if(l++,(c=n.parseVariables(o.substring(3),p)).length)for(var m=0;m<c.length;m++){var v=c[m];n.variables[v]?n.variables[v]++:n.variables[v]=1}else c=null;h=!0,d=!0}else if("foreach "===o.substring(0,8))i++,t=o.substring(8).split(" "),p.push(t[0].trim()),-1!==(s=t[2].indexOf("."))&&(t[2]=t[2].substring(0,s)),c=t[2].trim(),-1===p.indexOf(c)?(n.variables[c]?n.variables[c]++:n.variables[c]=1,c=[c]):c=null,g=!0;else if("else if "===o.substring(0,8)){if((c=n.parseVariables(o.substring(8),p)).length)for(var m=0;m<c.length;m++){var v=c[m];n.variables[v]?n.variables[v]++:n.variables[v]=1}else c=null;h=!0}else if("continue"!==o&&"break"!==o&&"else"!==o){if((c=o?o.match(a):null)&&(c=c.toString()),c&&r[c]&&(c=null),c&&-1===p.indexOf(c)?(n.variables[c]?n.variables[c]++:n.variables[c]=1,c=[c]):c=null,-1===o.indexOf("|")&&(o+=" | encode"),f=o.split("|"),o=f[0],(f=f.slice(1)).length)for(var m=0;m<f.length;m++){var b=f[m].trim();s=b.indexOf("("),b=-1===s?"Thelpers.$execute(model,'"+b+"',)":"Thelpers.$execute(model,'"+b.substring(0,s)+"',,"+b.substring(s+1),f[m]=b}else f=null;o=n.safe(o.trim()||"model"),d=!1}return n.commands.push({index:n.commands.length,cmd:o,ifcount:l,loopcount:i,variable:c,helpers:f,isloop:g,isif:h,iscode:d}),n.split}).split(n.split);for(var c=0,f=n.builder.length;c<f;c++)n.builder[c]=n.builder[c].replace(o,"");return n.make()},p.prototype.parseVariables=function(e,a){for(var s=[],u=e.split(t),o=0,p=u.length;o<p;o++)for(var c=u[o].replace(i,""),f=c.match(n),h=0;h<f.length;h++)!(c=(c=f[h]).split(".")[0])||l.test(c)||r[c]||-1===s.indexOf(c)&&-1===a.indexOf(c)&&s.push(c);return s},p.prototype.safe=function(e){for(var r=e.split("."),t=[],n=1;n<r.length;n++){var a=r.slice(0,n).join(".");t.push(a+"==null?'':")}return t.join("")+r.join(".")},p.prototype.make=function(){for(var e=["var $output=$text[0];var $tmp;var $index=0;"],r=0,t=this.commands.length;r<t;r++){var n,a=this.commands[r];if(r&&e.push("$output+=$text["+r+"];"),a.iscode)if(a.isloop){var l="$i"+Math.random().toString(16).substring(3,6),i=l+"a";n=a.cmd.substring(a.cmd.lastIndexOf(" in ")+4).trim(),n=i+"="+this.safe(n)+";if(!("+i+" instanceof Array)){if("+i+"&&typeof("+i+")==='object')"+i+"=Tangular.toArray("+i+")}if("+i+" instanceof Array&&"+i+".length){for(var "+l+"=0,"+l+"l="+i+".length;"+l+"<"+l+"l;"+l+"++){$index="+l+";var "+a.cmd.split(" ")[1]+"="+i+"["+l+"];",e.push(n)}else if(a.isif)"else if "===a.cmd.substring(0,8)?e.push("}"+a.cmd.substring(0,8).trim()+"("+a.cmd.substring(8).trim()+"){"):e.push(a.cmd.substring(0,3).trim()+"("+a.cmd.substring(3).trim()+"){");else switch(a.cmd){case"else":e.push("}else{");break;case"end":e.push("}}");break;case"fi":e.push("}");break;case"break":e.push("break;");break;case"continue":e.push("continue;")}else if(a.helpers){for(var s="",u=0;u<a.helpers.length;u++){var o=a.helpers[u];s=0===u?o.replace("",a.cmd.trim()).trim():o.replace("",s.trim())}e.push("$tmp="+s+";if($tmp!=null)$output+=$tmp;")}else e.push("if("+a.cmd+"!=null)$output+="+a.cmd+";")}e.push((t?"$output+=$text["+t+"];":"")+"returnÂ $output;"),delete this.variables.$;for(var p=Object.keys(this.variables),c=["$ || {}","model"],r=0;r<p.length;r++)c.push("model."+p[r]);var f="var tangular=function($,model"+(p.length?","+p.join(","):"")+"){"+e.join("")+"};return function(model,$){return tangular("+c.join(",")+");}";return new Function("$text",f)(this.builder)}}),e("skylark-tangular/compile",["./tangular","./Template"],function(e,r){return e.compile=function(e){return(new r).compile(e)}}),e("skylark-tangular/helpers",["./tangular"],function(e){var r={},t=/[<>&"]/g;return r.$execute=function(e,t,n,a,l,i,s,u,o,p){return null==r[t]?(console&&console.warn("Tangular: missing helper",'"'+t+'"'),n):r[t].call(e,n,a,l,i,s,u,o,p)},r.encode=function(e){return null==e?"":e.toString().replace(t,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;"}return e})},r.raw=function(e){return e},e.helpers=r}),e("skylark-tangular/register",["./tangular","./helpers"],function(e,r){return e.register=function(e,t){return r[e]=t,this}}),e("skylark-tangular/render",["./tangular","./Template"],function(e,r){return e.render=function(e,t,n){return null==t&&(t={}),(new r).compile(e)(t,n)}}),e("skylark-tangular/globals",["./tangular","./helpers"],function(e){return e.globals=function(){var r=window;return r.Ta=r.Tangular=e,r.Thelpers=e.helpers,r}}),e("skylark-tangular/main",["./tangular","./compile","./helpers","./register","./render","./Template","./globals"],function(e){return e}),e("skylark-tangular",["skylark-tangular/main"],function(e){return e})}(t),!a){var s=n("skylark-langx/skylark");l?module.exports=s:r.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-tangular.js.map
